import tkinter as tk
from tkinter import messagebox
from PIL import Image, ImageTk
import random
import os
#initializing main window
class JokeTellerApp:
    def __init__(self, root):
        self.root = root
        self.root.title("Alexa tell me a joke")
        self.root.geometry("600x400")

#Setting up bsckground image
        self.setup_background()   

        # Load jokes
        self.jokes = self.load_jokes()
        self.current_joke = None

        # Title Label
        self.title_label = tk.Label(
            root,
            text=" Alexa tell me a joke ",
            font=("Arial", 24, "bold"),
            bg="#2C3E50",
            fg="#ECF0F1"
        )
        self.title_label.pack(pady=20)

        # Setup Label where joke appears
        self.setup_label = tk.Label(
            root,
            text="Want to hear a joke? I've got plenty click the button!",
            font=("Arial", 14),
            bg="#34495E",
            fg="#ECF0F1",
            wraplength=500,
            justify="center",
            padx=20,
            pady=20
        )
        self.setup_label.pack(pady=10, padx=20, fill="both", expand=True)

        # Punchline Label
        self.punchline_label = tk.Label(
            root,
            text="",
            font=("Arial", 13, "italic"),
            bg="#E74C3C",
            fg="#FFFFFF",
            wraplength=500,
            justify="center",
            padx=20,
            pady=15
        )

        # Button Frame for orgainizing 
        self.button_frame = tk.Frame(root, bg="#2C3E50")
        self.button_frame.pack(pady=20)

        # Tell Joke button for diaplaying random joke
        self.tell_joke_button = tk.Button(
            self.button_frame,
            text="Alexa tell me a Joke",
            font=("Arial", 12, "bold"),
            bg="#3498DB",
            fg="white",
            padx=20,
            pady=10,
            command=self.tell_joke
        )
        self.tell_joke_button.grid(row=0, column=0, padx=5)

        # Show Punchline button for revealing joke punchline
        self.show_punchline_button = tk.Button(
            self.button_frame,
            text="Show Punchline",
            font=("Arial", 12, "bold"),
            bg="#E4F0E9",
            fg="grey",
            padx=20,
            pady=10,
            command=self.show_punchline,
            state="disabled" 
        )
        self.show_punchline_button.grid(row=0, column=1, padx=5)

        #  to display Next Joke button
        self.next_joke_button = tk.Button(
            self.button_frame,
            text="Next Joke",
            font=("Arial", 12, "bold"),
            bg="#F6D092",
            fg="white",
            padx=20,
            pady=10,
            command=self.next_joke,
            state="disabled"
        )
        self.next_joke_button.grid(row=1, column=0, padx=5, pady=10)

        # Quit button to close the program
        self.quit_button = tk.Button(
            self.button_frame,
            text="Quit",
            font=("Arial", 12, "bold"),
            bg="#8B4F49",
            fg="white",
            padx=20,
            pady=10,
            command=self.quit_app
        )
        self.quit_button.grid(row=1, column=1, padx=5, pady=10)
# load background to the program
    def setup_background(self):
        """Setup background image behind all widgets"""
        try:
            bg_image_path = "joke/jokebg.jpg"
            if os.path.exists(bg_image_path):
                image = Image.open(bg_image_path)
                image = image.resize((600, 400), Image.Resampling.LANCZOS)
                self.bg_photo = ImageTk.PhotoImage(image)

                self.canvas = tk.Canvas(self.root, width=600, height=400, highlightthickness=0)
                self.canvas.place(x=0, y=0, relwidth=1, relheight=1)

                self.canvas.create_image(0, 0, image=self.bg_photo, anchor="nw")
                self.canvas.create_rectangle(0, 0, 600, 400, fill="#2C3E50", stipple="gray50")

                self.canvas.lower()
            else:
                self.root.config(bg="#2C3E50")
        except Exception as e:
            print(f"Background load error: {e}")
            self.root.config(bg="#2C3E50")
# read jokes from file
    def load_jokes(self):
        jokes = []
        file_path = "joke/randomJokes.txt"
        
        if not os.path.exists(file_path):
            messagebox.showerror("Error", "Jokes file not found!")
            return []

        with open(file_path, "r") as file:
            for line in file:
                line = line.strip()
                if line and "?" in line:
                    line = line.lstrip("- ")
                    parts = line.split("?", 1)
                    if len(parts) == 2:
                        setup = parts[0].strip() + "?"
                        punchline = parts[1].strip()
                        jokes.append({"setup": setup, "punchline": punchline})
        return jokes

    def tell_joke(self):
        if not self.jokes:
            messagebox.showwarning("No Jokes", "No jokes available!")
            return
        self.current_joke = random.choice(self.jokes)
        self.setup_label.config(text=self.current_joke["setup"])
        # Hide punchline and update buttons
        self.punchline_label.pack_forget()
        self.show_punchline_button.config(state="normal")
        self.tell_joke_button.config(state="disabled")
        self.next_joke_button.config(state="disabled")

    def show_punchline(self):
        if self.current_joke:
            self.punchline_label.config(text=self.current_joke["punchline"])
            self.punchline_label.pack(pady=10, padx=20, fill="x")
            self.show_punchline_button.config(state="disabled")
            self.next_joke_button.config(state="normal")

    def next_joke(self):
        self.punchline_label.pack_forget()
        self.setup_label.config(text="Ready for another joke?")
        self.tell_joke_button.config(state="normal")
        self.show_punchline_button.config(state="disabled")
        self.next_joke_button.config(state="disabled")

    def quit_app(self):
        self.root.quit()


# Run the program
if __name__ == "__main__":
    root = tk.Tk()
    app = JokeTellerApp(root)
    root.mainloop()
